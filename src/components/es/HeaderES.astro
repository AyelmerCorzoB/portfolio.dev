---
import ThemeToggle from "../../components/en/ThemeToggle.astro";
import { getRelativeLocaleUrl } from "astro:i18n";

const navItems = [
  {
    title: "Proyectos",
    label: "proyectos",
    url: "/es/#proyectos",
  },
  {
    title: "Experiencia",
    label: "experiencia",
    url: "/es/#experiencia",
  },
  {
    title: "Habilidades",
    label: "habilidades",
    url: "/es/#habilidades",
  },
  {
    title: "Sobre mí",
    label: "sobre-mi",
    url: "/es/#sobre-mi",
  },
  {
    title: "Contacto",
    label: "contacto",
    url: "mailto:corzobarbosaa@gmail.com",
  },
];
---
<!-- HEADER EN ESPAÑOL -->
<header
  class="fixed top-0 z-10 flex items-center justify-center w-full mx-auto mt-2"
>
  <div class="container px-2 mx-auto">
    <nav class="flex items-center justify-between rounded-full py-2 px-4">
      <!-- Logo or Brand -->
      <div class="flex items-center">
        <a href="/es">
          <img src="/favicon.png" class="size-15" alt="Logo" />
          </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center justify-center space-x-1">
        {
          navItems.map((link) => (
            <a
              class="relative px-3 py-2 text-sm font-medium transition text-black/80 dark:text-gray-200 hover:text-yellow-400 dark:hover:text-yellow-400"
              aria-label={link.label}
              href={link.url}
            >
              {link.title}
            </a>
          ))
        }
      </div>

      <!-- Desktop: Download CV and Theme Toggle -->
      <div class="hidden md:flex items-center gap-4">
        <a
          href="/CV-AyelmerCorzo.pdf"
          download="currículum-vitae-AyelmerCorzo.pdf"
          class="inline-flex items-center gap-2 px-4 py-2 bg-yellow-400 text-gray-900 text-sm font-semibold rounded-full shadow-md hover:bg-yellow-500 hover:shadow-lg transition-all duration-300 transform hover:scale-105"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
          <span>Descargar CV</span>
        </a>
        <ThemeToggle />
        <div
          id="mobile-language-selector"
          class="flex gap-4 mt-4 px-3 py-2 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-white rounded-md"
        >
          <a href={getRelativeLocaleUrl('en')} class="hover:text-yellow-400 font-medium"
            >Ingles</a
          >
          <span class="text-gray-400">|</span>
          <a href={getRelativeLocaleUrl('es')}class="hover:text-yellow-400 font-medium"
            >Español</a
          >
        </div>
      </div>

      <!-- Mobile: Hamburger Menu and Download CV -->
      <div class="flex items-center md:hidden">
        <a
          href="/CV-AyelmerCorzo.pdf"
          download="currículum-vitae-AyelmerCorzo.pdf"
          class="mr-2 inline-flex items-center gap-1 px-3 py-1.5 bg-yellow-400 text-gray-900 text-xs font-semibold rounded-full shadow-md"
          aria-label="Descargar CV"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
          <span>CV</span>
        </a>

        <button
          id="menu-toggle"
          class="p-2 rounded-md text-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none"
          aria-label="Toggle menu"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </nav>
  </div>

  <!-- Mobile Menu Overlay -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-gray-950 z-50 hidden flex-col justify-center items-center"
  >
    <div class="absolute top-4 right-4">
      <button id="close-menu" class="p-2 text-white" aria-label="Close menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-8 w-8"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <ul class="flex flex-col items-center space-y-6">
      {
        navItems.map((link) => (
          <li>
            <a
              class="text-xl font-medium text-white hover:text-yellow-400 transition-colors"
              aria-label={link.label}
              href={link.url}
            >
              {link.title}
            </a>
          </li>
        ))
      }
      <li class="mt-8">
        <a
          href="/CV-AyelmerCorzo.pdf"
          download="currículum-vitae-AyelmerCorzo.pdf"
          class="inline-flex items-center gap-2 px-6 py-3 bg-yellow-400 text-gray-900 font-semibold rounded-full shadow-md hover:bg-yellow-500 hover:shadow-lg transition-all duration-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
          <span>Descargar CV</span>
        </a>
      </li>

      <!-- Mobile: Theme Toggle and Language Selector -->
      <li class="mt-6">
        <div class="flex flex-col items-center gap-4">
          <ThemeToggle />
          <div id="mobile-language-selector" class="flex gap-4 mt-4 px-3 py-2 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-white rounded-md">
            <a href="/en" class="hover:text-yellow-400 font-medium">English</a>
            <span class="text-gray-400">|</span>
            <a href="/es" class="text-yellow-400 font-medium" aria-current="page">Español</a>
          </div>
        </div>
      </li>
    </ul>
  </div>
</header>

<style>
  nav {
    position: relative;
    z-index: 50;
    animation: nav-shadow 0.5s ease-out both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  @keyframes nav-shadow {
    0% {
      background-color: transparent;
      box-shadow: none;
      backdrop-filter: none;
    }
    100% {
      background-color: rgba(224, 203, 15, 0.363);
      box-shadow:
        0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05);
      backdrop-filter: blur(10px);
    }
  }

  /* Estilos para el modo oscuro */
  .dark nav {
    animation: nav-shadow-dark 0.5s ease-out both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  @keyframes nav-shadow-dark {
    0% {
      background-color: transparent;
      box-shadow: none;
      backdrop-filter: none;
    }
    100% {
      background-color: rgba(33, 33, 33, 0.5);
      box-shadow:
        0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05);
      backdrop-filter: blur(10px);
    }
  }
</style>

<script>
  function setupMobileMenu() {
    const menuToggle = document.getElementById("menu-toggle");
    const closeMenu = document.getElementById("close-menu");
    const mobileMenu = document.getElementById("mobile-menu");

    if (!menuToggle || !closeMenu || !mobileMenu) {
      console.error("Menu elements not found");
      return;
    }

    const openMenu = () => {
      mobileMenu.classList.remove("hidden");
      mobileMenu.classList.add("flex");
      document.body.style.overflow = "hidden"; // Prevent scrolling when menu is open
    };

    const closeMenuHandler = () => {
      mobileMenu.classList.add("hidden");
      mobileMenu.classList.remove("flex");
      document.body.style.overflow = ""; // Restore scrolling
    };

    menuToggle.addEventListener("click", openMenu);
    menuToggle.addEventListener("touchend", (e) => {
      e.preventDefault();
      openMenu();
    });

    closeMenu.addEventListener("click", closeMenuHandler);
    closeMenu.addEventListener("touchend", (e) => {
      e.preventDefault();
      closeMenuHandler();
    });

    // Close menu when clicking on a link
    const menuLinks = mobileMenu.querySelectorAll("a");
    menuLinks.forEach((link) => {
      link.addEventListener("click", closeMenuHandler);
    });

    // Handle window resize
    window.addEventListener("resize", () => {
      if (
        window.innerWidth >= 768 &&
        !mobileMenu.classList.contains("hidden")
      ) {
        mobileMenu.classList.add("hidden");
        mobileMenu.classList.remove("flex");
        document.body.style.overflow = ""; // Restore scrolling
      }
    });
  }

  document.addEventListener("astro:page-load", setupMobileMenu);

  // Also run on initial page load in case astro:page-load doesn't fire
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupMobileMenu);
  } else {
    setupMobileMenu();
  }
  function setupLanguageSelectors() {
  console.log("Language selector change detected");
  const languageSelector = document.getElementById("language-selector");
  const mobileLanguageSelector = document.getElementById("mobile-language-selector");

  if (languageSelector) {
    languageSelector.addEventListener("change", () => {
      // Mostrar el modal de construcción
      if (window.showConstructionModal) {
        window.showConstructionModal();
      }
    });
  }

  if (mobileLanguageSelector) {
    mobileLanguageSelector.addEventListener("change", () => {
      // Mostrar el modal de construcción
      if (window.showConstructionModal) {
        window.showConstructionModal();
      }
    });
  }
}

// Ejecutar la configuración del modal y los selectores de idioma
document.addEventListener("astro:page-load", () => {
  setupMobileMenu();
  setupLanguageSelectors(); // Asegúrate de llamar esta función
});

// Ejecutar en la carga inicial de la página
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", () => {
    setupMobileMenu();
    setupLanguageSelectors(); // Asegúrate de llamar esta función
  });
} else {
  setupMobileMenu();
  setupLanguageSelectors(); // Asegúrate de llamar esta función
}
</script>

