---
import ThemeToggle from "../../components/en/ThemeToggle.astro";
const currentPath = Astro.url.pathname;
const isSpanish = currentPath.startsWith("/es");

const navItems = [
  {
    title: "Proyectos",
    label: "projects",
    url: "/es/#projects",
    icon: "M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z",
  },
  {
    title: "Experiencia",
    label: "experience",
    url: "/es/#experience",
    icon: "M20 6h-2V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM12 4h4v2h-4V4zm8 16H8V8h2v2h8V8h2v12z",
  },
  {
    title: "Habilidades",
    label: "skills",
    url: "/es/#skills",
    icon: "M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z",
  },
  {
    title: "Sobre mí",
    label: "about me",
    url: "/es/#about-me",
    icon: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",
  },
  {
    title: "Contacto",
    label: "contact",
    url: "mailto:corzobarbosaa@gmail.com",
    icon: "M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z",
  },
];
---

<header class="fixed top-0 z-50 w-full">
  <div class="container mx-auto px-4 pt-4">
    <nav
      class="nav-container relative flex items-center justify-between rounded-2xl py-3 px-6 transition-all duration-500 ease-out"
    >
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/es" class="group relative transition-all duration-300 hover:scale-110" aria-label="Inicio">
          <div class="absolute inset-0 rounded-full bg-gradient-to-r from-yellow-400/20 to-orange-400/20 blur-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300">
          </div>
          <img src="/favicon.png" class="relative size-10 sm:size-12 rounded-full shadow-lg ring-2 ring-white/10 group-hover:ring-yellow-400/30 transition-all duration-300" alt="Ayelmer Corzo Logo"/>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center justify-center">
        <div
          class="flex items-center space-x-1 bg-white/5 dark:bg-black/20 backdrop-blur-xl rounded-full p-1 border border-white/10"
        >
          {
            navItems.map((link) => (
              <a
                class="group relative px-4 py-2.5 text-sm font-medium transition-all duration-300 text-gray-700 dark:text-gray-200 hover:text-yellow-500 dark:hover:text-yellow-400 rounded-full overflow-hidden"
                aria-label={link.label}
                href={link.url}
              >
                <div class="absolute inset-0 bg-gradient-to-r from-yellow-400/10 to-orange-400/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full" />
                <div class="relative flex items-center gap-2">
                  <svg
                    class="w-4 h-4 opacity-70 group-hover:opacity-100 transition-opacity duration-300"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path d={link.icon} />
                  </svg>
                  <span>{link.title}</span>
                </div>
              </a>
            ))
          }
        </div>
      </div>

      <!-- Desktop Actions -->
      <div class="hidden md:flex items-center gap-3">
        <div
          class="flex items-center gap-1 px-3 py-2 bg-white/10 dark:bg-black/20 backdrop-blur-xl rounded-full border border-white/10"
        >
          <a
            href="/en"
            class={`px-3 py-1.5 text-sm font-medium rounded-full transition-all duration-300 ${
              !isSpanish
                ? "bg-yellow-400 text-gray-900 shadow-lg"
                : "text-gray-600 dark:text-gray-300 hover:text-yellow-400 hover:bg-white/10"
            }`}
          >
            EN
          </a>
          <a
            href="/es"
            class={`px-3 py-1.5 text-sm font-medium rounded-full transition-all duration-300 ${
              isSpanish
                ? "bg-yellow-400 text-gray-900 shadow-lg"
                : "text-gray-600 dark:text-gray-300 hover:text-yellow-400 hover:bg-white/10"
            }`}
          >
            ES
          </a>
        </div>

        <ThemeToggle />

        <a
          href="/CV-AyelmerCorzo.pdf"
          download="currículum-vitae-AyelmerCorzo.pdf"
          class="group relative inline-flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-yellow-400 to-orange-400 text-gray-900 text-sm font-semibold rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:ring-offset-2 overflow-hidden"
          aria-label="Descargar CV"
        >
          <div
            class="absolute inset-0 bg-gradient-to-r from-yellow-300 to-orange-300 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
          >
          </div>
          <svg
            class="relative w-4 h-4 group-hover:animate-bounce"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
          <span class="relative">Descargar CV</span>
        </a>
      </div>

      <!-- Mobile Actions -->
      <div class="flex items-center md:hidden gap-3">
        <div class="flex items-center gap-2">
          <!-- Language Switcher Mobile -->
          <div
            class="flex items-center gap-0.5 px-2.5 py-1.5 bg-white/10 dark:bg-black/20 backdrop-blur-xl rounded-full border border-white/10"
          >
            <a
              href="/en"
              class={`px-2 py-1 text-xs font-medium rounded-full transition-all duration-300 ${
                !isSpanish
                  ? "bg-yellow-400 text-gray-900 shadow-md"
                  : "text-gray-600 dark:text-gray-300 hover:text-yellow-400 hover:bg-white/10"
              }`}
            >
              EN
            </a>
            <a
              href="/es"
              class={`px-2 py-1 text-xs font-medium rounded-full transition-all duration-300 ${
                isSpanish
                  ? "bg-yellow-400 text-gray-900 shadow-md"
                  : "text-gray-600 dark:text-gray-300 hover:text-yellow-400 hover:bg-white/10"
              }`}
            >
              ES
            </a>
          </div>
        </div>

        <!-- Download CV Mobile -->
        <a
          href="/CV-AyelmerCorzo.pdf"
          download="currículum-vitae-AyelmerCorzo.pdf"
          class="group inline-flex items-center gap-1.5 px-3 py-2 bg-gradient-to-r from-yellow-400 to-orange-400 text-gray-900 text-xs font-semibold rounded-full shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95"
          aria-label="Descargar CV"
        >
          <svg
            class="w-3.5 h-3.5 group-active:animate-bounce"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
          <span>CV</span>
        </a>

        <!-- Hamburger Menu Button -->
        <button
          id="menu-toggle"
          class="relative p-2.5 rounded-xl bg-white/10 dark:bg-black/20 backdrop-blur-xl border border-white/10 text-gray-700 dark:text-gray-200 hover:bg-white/20 dark:hover:bg-black/30 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition-all duration-300 active:scale-95"
          aria-label="Abrir menú"
          aria-expanded="false"
        >
          <div class="menu-icon relative w-6 h-6">
            <span
              class="menu-line absolute left-0 top-1 w-6 h-0.5 bg-current rounded-full transition-all duration-300"
            ></span>
            <span
              class="menu-line absolute left-0 top-3 w-6 h-0.5 bg-current rounded-full transition-all duration-300"
            ></span>
            <span
              class="menu-line absolute left-0 top-5 w-6 h-0.5 bg-current rounded-full transition-all duration-300"
            ></span>
          </div>
        </button>
      </div>
    </nav>
  </div>

  <!-- Mobile Menu Overlay -->
  <div
    id="mobile-menu"
    class="fixed inset-0 z-40 hidden opacity-0 transition-all duration-500"
    role="dialog"
    aria-modal="true"
  >
    <!-- Backdrop -->
    <div
      class="absolute inset-0 bg-gradient-to-br from-gray-900/96 via-gray-800/96 to-gray-900/96 backdrop-blur-3xl"
    >
    </div>

    <!-- Menu Content -->
    <div class="relative flex flex-col h-full">
      <!-- Header with close button -->
      <div class="flex justify-between items-center p-6">
        <div class="flex items-center gap-3">
          <img
            src="/favicon.png"
            class="size-8 rounded-full shadow-lg ring-2 ring-yellow-400/30"
            alt="Logo"
          />
          <span class="text-white font-semibold text-lg">Menú</span>
        </div>

        <button
          id="close-menu"
          class="p-2.5 text-white/80 hover:text-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 rounded-xl bg-white/5 backdrop-blur-xl border border-white/10 transition-all duration-300 hover:scale-110 active:scale-95"
          aria-label="Cerrar menú"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Navigation Links -->
      <div class="flex-1 flex flex-col justify-center px-6">
        <nav class="space-y-4">
          {
            navItems.map((link, index) => (
              <a
                class="group mobile-nav-item flex items-center gap-4 p-4 text-xl font-medium text-white/90 hover:text-yellow-400 transition-all duration-500 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 rounded-2xl hover:bg-white/5 backdrop-blur-xl border border-transparent hover:border-white/10 active:scale-95"
                href={link.url}
                style={`animation-delay: ${index * 100}ms`}
              >
                <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-white/5 group-hover:bg-yellow-400/20 transition-all duration-300">
                  <svg
                    class="w-6 h-6 opacity-70 group-hover:opacity-100 transition-all duration-300"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path d={link.icon} />
                  </svg>
                </div>
                <span class="flex-1">{link.title}</span>
                <svg
                  class="w-5 h-5 opacity-40 group-hover:opacity-80 group-hover:translate-x-1 transition-all duration-300"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                    clip-rule="evenodd"
                  />
                </svg>
              </a>
            ))
          }
        </nav>
      </div>

      <!-- Bottom Actions -->
      <div class="p-6 space-y-6 border-t border-white/10">
        <!-- Language Switcher -->
        <div class="flex justify-center">
          <div
            class="flex items-center gap-2 px-6 py-3 bg-white/10 backdrop-blur-xl rounded-full border border-white/20"
          >
            <a
              href="/en"
              class={`px-4 py-2 font-medium rounded-full transition-all duration-300 text-sm ${
                !isSpanish
                  ? "bg-yellow-400 text-gray-900 shadow-lg"
                  : "text-white/80 hover:text-yellow-400 hover:bg-white/10 active:scale-95"
              }`}
            >
              English
            </a>
            <div class="w-px h-4 bg-white/20"></div>
            <a
              href="/es"
              class={`px-4 py-2 font-medium rounded-full transition-all duration-300 text-sm ${
                isSpanish
                  ? "bg-yellow-400 text-gray-900 shadow-lg"
                  : "text-white/80 hover:text-yellow-400 hover:bg-white/10 active:scale-95"
              }`}
            >
              Español
            </a>
          </div>
        </div>

        <!-- Download CV -->
        <div class="flex justify-center">
          <a
            href="/CV-AyelmerCorzo.pdf"
            download="currículum-vitae-AyelmerCorzo.pdf"
            class="group inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-yellow-400 to-orange-400 text-gray-900 font-semibold rounded-full shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 active:scale-95"
            aria-label="Descargar CV"
          >
            <svg
              class="w-5 h-5 group-hover:animate-bounce group-active:animate-pulse"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                clip-rule="evenodd"></path>
            </svg>
            <span>Descargar CV</span>
          </a>
        </div>

        <!-- Safe Area Spacing -->
        <div class="h-4 sm:h-2"></div>
      </div>
    </div>
  </div>
</header>

<style>
  .nav-container {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    animation: nav-scroll 0.3s ease-out both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  .dark .nav-container {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  @keyframes nav-scroll {
    0% {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    }
    100% {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(30px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  }

  .dark .nav-container {
    animation: nav-scroll-dark 0.3s ease-out both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  @keyframes nav-scroll-dark {
    0% {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }
    100% {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(30px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  }

  /* Mobile menu animations */
  #mobile-menu.show {
    opacity: 1;
  }

  .mobile-nav-item {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
  }

  #mobile-menu.show .mobile-nav-item {
    animation: slideInUp 0.6s ease-out forwards;
  }

  @keyframes slideInUp {
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Hamburger menu animation */
  #menu-toggle.active .menu-line:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
  }

  #menu-toggle.active .menu-line:nth-child(2) {
    opacity: 0;
    transform: scale(0);
  }

  #menu-toggle.active .menu-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }

  /* Enhanced hover effects */
  @media (hover: hover) {
    .nav-container:hover {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .dark .nav-container:hover {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
  }

  /* Mobile-specific styles */
  @media (max-width: 767px) {
    .nav-container {
      margin: 0 8px;
      padding: 12px 16px;
    }

    #mobile-menu {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* Improve touch targets */
    .mobile-nav-item {
      min-height: 60px;
    }

    /* Better spacing for mobile */
    .container {
      padding-left: 16px;
      padding-right: 16px;
    }
  }

  /* Extra small devices */
  @media (max-width: 375px) {
    .nav-container {
      margin: 0 4px;
      padding: 10px 12px;
    }

    .mobile-nav-item {
      font-size: 18px;
      padding: 16px;
    }
  }

  /* Large mobile devices */
  @media (min-width: 480px) and (max-width: 767px) {
    .mobile-nav-item {
      font-size: 22px;
      padding: 20px;
    }
  }

  /* Landscape orientation optimization */
  @media (max-height: 600px) and (orientation: landscape) {
    #mobile-menu .flex-1 {
      padding-top: 20px;
      padding-bottom: 20px;
    }

    .mobile-nav-item {
      padding: 12px 16px;
      font-size: 18px;
    }

    #mobile-menu .space-y-6 > * + * {
      margin-top: 16px;
    }

    #mobile-menu .space-y-4 > * + * {
      margin-top: 12px;
    }
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .mobile-nav-item,
    .nav-container,
    #mobile-menu {
      animation: none !important;
      transition: none !important;
    }
  }
</style>

<script>
  function setupMobileMenu() {
    const menuToggle = document.getElementById("menu-toggle");
    const closeMenu = document.getElementById("close-menu");
    const mobileMenu = document.getElementById("mobile-menu");

    if (!menuToggle || !closeMenu || !mobileMenu) return;

    const openMenu = () => {
      mobileMenu.classList.remove("hidden");
      requestAnimationFrame(() => {
        mobileMenu.classList.add("show");
        menuToggle.classList.add("active");
        menuToggle.setAttribute("aria-expanded", "true");
        document.body.style.overflow = "hidden";

        // Add safe area padding for devices with notches
        document.body.style.paddingTop = "env(safe-area-inset-top)";

        closeMenu.focus();
      });
    };

    const closeMenuHandler = () => {
      mobileMenu.classList.remove("show");
      menuToggle.classList.remove("active");
      menuToggle.setAttribute("aria-expanded", "false");
      document.body.style.overflow = "";
      document.body.style.paddingTop = "";

      setTimeout(() => {
        mobileMenu.classList.add("hidden");
      }, 500);

      menuToggle.focus();
    };

    // Toggle menu
    menuToggle.addEventListener("click", () => {
      if (menuToggle.classList.contains("active")) {
        closeMenuHandler();
      } else {
        openMenu();
      }
    });

    // Close menu
    closeMenu.addEventListener("click", closeMenuHandler);

    // Close on navigation link clicks
    mobileMenu.querySelectorAll("nav a").forEach((link) => {
      link.addEventListener("click", (e) => {
        // Add a small delay for better UX
        setTimeout(closeMenuHandler, 150);
      });
    });

    // Close on Escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !mobileMenu.classList.contains("hidden")) {
        closeMenuHandler();
      }
    });

    // Close on window resize to desktop
    window.addEventListener("resize", () => {
      if (
        window.innerWidth >= 768 &&
        !mobileMenu.classList.contains("hidden")
      ) {
        closeMenuHandler();
      }
    });

    // Enhanced focus trap
    const trapFocus = (e: KeyboardEvent) => {
      if (mobileMenu.classList.contains("hidden")) return;

      const focusableElements = mobileMenu.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      const firstElement = focusableElements[0] as HTMLElement;
      const lastElement = focusableElements[
        focusableElements.length - 1
      ] as HTMLElement;

      if (e.key === "Tab") {
        if (e.shiftKey) {
          if (document.activeElement === firstElement) {
            lastElement.focus();
            e.preventDefault();
          }
        } else {
          if (document.activeElement === lastElement) {
            firstElement.focus();
            e.preventDefault();
          }
        }
      }
    };

    document.addEventListener("keydown", trapFocus);

    // Prevent scroll on mobile when menu is open
    let lastScrollY = 0;
    const preventScroll = (e: TouchEvent) => {
      if (!mobileMenu.classList.contains("hidden")) {
        const target = e.target as HTMLElement;
        if (!target.closest("button, a, input, [role='switch']")) {
          e.preventDefault();
        }
      }
    };

    document.addEventListener("touchmove", preventScroll, { passive: false });

    // Handle orientation change
    window.addEventListener("orientationchange", () => {
      if (!mobileMenu.classList.contains("hidden")) {
        // Small delay to account for orientation change
        setTimeout(() => {
          window.scrollTo(0, lastScrollY);
        }, 100);
      }
    });

    // Store scroll position when menu opens
    menuToggle.addEventListener("click", () => {
      if (!menuToggle.classList.contains("active")) {
        lastScrollY = window.scrollY;
      }
    });
  }

  // Initialize
  document.addEventListener("astro:page-load", setupMobileMenu);

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupMobileMenu);
  } else {
    setupMobileMenu();
  }
</script>
